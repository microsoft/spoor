# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

steps:
- script: |
    pkgutil --pkg-info=com.apple.pkg.CLTools_Executables
    softwareupdate --list
  displayName: Update Xcode Command Line Tools
  condition: eq(variables['Agent.OS'], 'Darwin')
- script: |
    wget https://apt.llvm.org/llvm.sh
    chmod +x llvm.sh
    sudo ./llvm.sh 12
    sudo ./llvm.sh 11
  displayName: Install LLVM (Linux)
  condition: eq(variables['Agent.OS'], 'Linux')
- script: |
    brew install llvm@11
    brew install llvm@12
    echo '##vso[task.prependpath]/usr/local/opt/llvm@12/bin'
    # The default compiler is added last.
    echo '##vso[task.prependpath]/usr/local/opt/llvm@11/bin'
  displayName: Install LLVM (macOS)
  condition: eq(variables['Agent.OS'], 'Darwin')
- script: pip3 install pylint yapf
  displayName: Install Pylint and YAPF
- script: cat .build/macos-ci.bazelrc .build/ci.bazelrc > .bazelrc
  displayName: Create .bazelrc (macOS)
  condition: eq(variables['Agent.OS'], 'Darwin')
