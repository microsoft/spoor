# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

jobs:
- job: build_and_test
  strategy:
    matrix:
      linux:
        imageName: 'ubuntu-20.04'
  pool:
    vmImage: $(imageName)
  steps:
  - template: ./templates/install-common.yml
  - script: bazel build //...
    displayName: Build
  - script: bazel test //...
    displayName: Test
  - script: ./toolchain/benchmark/run_benchmarks.sh
    displayName: Benchmark
  - script: ./toolchain/compilation_database/generate_compilation_database.sh
    displayName: Generate compilation database
  - script: bazel test --config=asan //...
    displayName: Address sanitizer
  - script: bazel test --config=tsan //...
    displayName: Thread sanitizer
  - script: bazel test --config=ubsan //...
    displayName: Undefined behavior sanitizer
    condition: eq(variables['Agent.OS'], 'Linux')
